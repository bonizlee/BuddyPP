<!DOCTYPE html>
<!--html5-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->

<!-- Mirrored from www.arduino.cc/en/Reference/RobotMotorWriteYourOwnFirmware by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 26 Oct 2015 14:08:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
  	<meta charset="utf-8" />

	<title>Arduino - RobotMotorWriteYourOwnFirmware </title>
	<link rel="shortcut icon" type="image/x-icon" href="../favicon.png" />

	<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>

	<link rel="stylesheet" href="../../fonts/fonts.css" type="text/css" />
	<link rel="stylesheet" href="../../css/arduino-icons.css">
	<link rel="stylesheet" href="../../css/animation.css"><!--[if IE 7]>
	<link rel="stylesheet" href="//arduino.cc/css/arduino-icons-ie7.css"><![endif]-->
	<!--[if gte IE 9]><!-->
	<link rel='stylesheet' href='../../css/foundation2.css' type='text/css' />
	<!--<![endif]-->
	<!--[if IE 8]>
		<link rel='stylesheet' href='//arduino.cc/css/foundation_ie8.css' type='text/css' />
	<![endif]-->
	<link rel='stylesheet' href='../../css/arduino_code_highlight.css' type='text/css' />
	<link rel="stylesheet" type="text/css" media="screen" href="../../css/typeplate.css">
	<link rel='stylesheet' href='../pub/skins/arduinoWide_SSO/css/arduinoWide_SSO.css' type='text/css' />

	<link rel='stylesheet' href='../../css/common.css' type='text/css' />
	<link rel="stylesheet" href="../../css/download_page.css" />
	<link href="https://plus.google.com/114839908922424087554" rel="publisher" />

	<!-- embedded JS and CSS from PmWiki plugins -->	
	<!--HeaderText--><style type='text/css'><!--
  ul, ol, pre, dl, p { margin-top:0px; margin-bottom:0px; }
  code { white-space: nowrap; }
  .vspace { margin-top:1.33em; }
  .indent { margin-left:40px; }
  .outdent { margin-left:40px; text-indent:-40px; }
  a.createlinktext { text-decoration:none; border-bottom:1px dotted gray; }
  a.createlink { text-decoration:none; position:relative; top:-0.5em;
    font-weight:bold; font-size:smaller; border-bottom:none; }
  img { border:0px; }
  
span.anchor {
	float: left;
	font-size: 10px;
	margin-left: -10px;
	width: 10px;
    position:relative; top:-0.1em;
	text-align: center;
}
span.anchor a { text-decoration: none; }
span.anchor a:hover { text-decoration: underline; }
ol.toc { text-indent:-20px; list-style: none; }
ol.toc ol.toc { text-indent:-40px; }
div.tocfloat { font-size: smaller; margin-bottom: 10px;
    border-top: 1px dotted #555555; border-bottom: 1px dotted #555555;
    padding-top: 5px; padding-bottom: 5px; 
    width: 38%; float: right; margin-left: 10px; clear: right;
    margin-right:-13px; padding-right: 13px; padding-left: 13px;
    background-color: #eeeeee; }
div.toc { font-size: smaller; 
    padding: 5px; border: 1px dotted #cccccc;
    background: #f7f7f7;
    margin-bottom: 10px; }
div.toc p { background-color: #f9f6d6;
    margin-top:-5px;   padding-top: 5px;
    margin-left:-5px;  padding-left: 5px;
    margin-right:-5px; padding-right: 5px;
    padding-bottom: 3px;
    border-bottom:  1px dotted #cccccc; }.editconflict { color:green; 
  font-style:italic; margin-top:1.33em; margin-bottom:1.33em; }

  table.markup { border: 2px dotted #ccf; width:90%; }
  td.markup1, td.markup2 { padding-left:10px; padding-right:10px; }
  td.markup1 { border-bottom: 1px solid #ccf; }
  div.faq { margin-left:2em; }
  div.faq p.question { margin: 1em 0 0.75em -2em; font-weight:bold; }
  div.faq hr { margin-left: -2em; }
   
    .frame 
      { border:1px solid #cccccc; padding:4px; background-color:#f9f9f9; }
    .lfloat { float:left; margin-right:0.5em; }
    .rfloat { float:right; margin-left:0.5em; }
a.varlink { text-decoration:none; }

.sourceblocklink {
  text-align: right;
  font-size: smaller;
}
.sourceblocktext {
  padding: 0.5em;
  color: #000000;
  background-color: #ECF1F1;
}
.sourceblock .sourceblocktext .arduino {
  font-family: 'TyponineSans Monospace Regular 4';
  font-size: 14px;
  line-height: 18px;
}
code {
  background-color: #ECF1F1;
  font-size: 15px;
  line-height: 19px;
  padding: 2px 10px 5px 10px;
}
.sourceblocktext div {
  font-family: monospace;
  font-size: small;
  line-height: 1;
  height: 1%;
}
.sourceblocktext div.head,
.sourceblocktext div.foot {
  font: italic medium serif;
  padding: 0.5em;
}

--></style><script type="text/javascript">
function toggle(obj) {
    var elstyle = document.getElementById(obj).style;
    var text    = document.getElementById(obj + "tog");
    if (elstyle.display == 'none') {
        elstyle.display = 'block';
        text.innerHTML = "hide";
    } else {
        elstyle.display = 'none';
        text.innerHTML = "show";
    }
}
</script><script src="http://www.arduino.cc/en/pub/galleria/galleria-1.2.6.min.js"></script><script type="text/javascript">Galleria.loadTheme("http://www.arduino.cc/en/pub/galleria/themes/classic/galleria.classic.min.js");</script>  <meta name='robots' content='index,follow' />


	<script src="http://arduino.cc/js/vendor/custom.modernizr.js"></script>

	<!-- do not remove none of those lines, comments embedding in pages will break! -->
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.min.js" type="text/javascript"></script>
	<script src="http://arduino.cc/en/pub/js/newsletter_subscribe_popup.js" type="text/javascript"></script>
	<script src="https://checkout.stripe.com/checkout.js" type="text/javascript"></script>
	<script src="https://www.arduino.cc/en/pub/js/software_download.js" type="text/javascript"></script><!-- keep https! -->
	<link rel='stylesheet' href='../../../code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.min.css' type='text/css' />
</head>
<body>

	<div id="menuWings" class="fixed"></div>
	<div id="page">
		
		
<script>
	var userAgent = (navigator.userAgent || navigator.vendor || window.opera).toLowerCase();
	if(userAgent.indexOf('mac')>0){
		$("head").append('<style type="text/css">@-moz-document url-prefix() {h1 a, h2 a, h3 a, h4 a, h5 a, h1 a:hover, h2 a:hover, th a, th a:hover, h3 a:hover, h4 a:hover, h5 a:hover, #wikitext h2 a:hover, #wikitext h3 a:hover, #wikitext h4 a:hover {padding-bottom: 0.5em!important;} #pageheader .search input{font-family: "TyponineSans Regular 18";} #pagefooter .monospace{margin-top: -4px;} #navWrapper ul.left &gt; li{margin-top: -2px; padding-bottom: 2px;}#navWrapper ul.right &gt; li{margin-top: -5px; padding-bottom: 5px;}#navWrapper ul.right &gt; li ul{margin-top: 4px;} .slider-container .fixed-caption p{padding:8px 0 14px 0}}</style>');
	}
</script>

<!--[if IE]>
<link rel='stylesheet' href='https://id.arduino.cc//css/ie-monospace.css' type='text/css' />
<![endif]-->

<div id="menuWings" class="fixed"></div>

<!--[if IE 8]>
<div class="alert-box panel ie8alert">
  <p><strong>Arduino.cc offers limited compatibility for Internet Explorer 8. Get a modern browser as Chrome, Firefox or Safari.</strong></p>
  <a href="" class="close">&times;</a>
</div>
<![endif]-->

 

		<div id="pagetext">
				<!--PageText-->
<div id='wikitext'>
<p><strong>Reference</strong> &nbsp;  <a class='wikilink' href='HomePage.html'>Language</a> | <a class='wikilink' href='Libraries.html'>Libraries</a> | <a class='wikilink' href='Comparison.html'>Comparison</a> | <a class='wikilink' href='Changes.html'>Changes</a>
</p>
<p class='vspace'></p><p><a class='wikilink' href='RobotLibrary.html'>Robot</a>
</p>
<p class='vspace'></p><h2>Write Your Own Firmware</h2>
<p>The Robot Motor Board is intended to work as a "state machine", which means it receives commands from the Robot Control Board and executes them accordingly. It also returns data when requested. The default motor board firmware does not house much intelligence, but does not need to be adjusted for most applications.
</p>
<p class='vspace'></p><p>You can, however, extend the functionality of the motor board by defining your own modes or creating your own command. To do this, you must modify the motor control board library files.
</p>
<p class='vspace'></p><p><em>These instructions are for people already comfortable with programming.</em>
</p>
<p class='vspace'></p><h3>Modes</h3>
<p>The robot has a number of pre-defined modes that instruct the motor board how to operate. For example, there is the "line following mode". When entering this mode, the motor board will read values from the infrared sensor array mounted on the bottom of the board, calculate the desired direction of robot and manipulate the motors directly. 
</p>
<p class='vspace'></p><p>You can change modes with <a class='wikilink' href='RobotSetMode.html'>setMode</a>() one the Control Board. 
</p>
<p class='vspace'></p><p>You can define your own modes. To create a new mode, you need to define the mode in both Control Board and Motor Board, and write the logic for the desired behavior.
</p>
<p class='vspace'></p><h4>Define a New Mode</h4>
<ul><li>In your OS, navigate to the Arduino sketches folder.
</li><li>Open "libraries/<span class='wikiword'>Robot_Control/ArduinoRobot</span>.h" and "libraries/<span class='wikiword'>Robot_Motor/ArduinoRobotMotorBoard</span>.h" in the text editor of your choice
</li><li>In each file, find the section with the mode definitions. It looks like this : 
</li></ul><p>
<div class='sourceblock ' id='sourceblock1'>
  <div class='sourceblocktext'><div>//motor board modes<br/>#define MODE_SIMPLE 0<br/>#define MODE_LINE_FOLLOW 1<br/>#define MODE_ADJUST_MOTOR 2<br/>#define MODE_IR_CONTROL 3<br/></div></div>
  <div class='sourceblocklink'><a href='http://www.arduino.cc/en/Reference/RobotMotorWriteYourOwnFirmware?action=sourceblock&amp;num=1' type='text/plain'>[Get Code]</a></div>
</div>

</p><ul><li>add a new mode after these in both files, like this : "#define MODE_MY_MODE_NAME num". <em>num</em> should be a different number than the other modes.
</li><li>Save and close <em><span class='wikiword'>ArduinoRobotMotorBoard</span>.h</em> and <em><span class='wikiword'>ArduinoRobot</span>.h</em>
</li><li>Open "libraries/<span class='wikiword'>Robot_Motor/ArduinoRobotMotorBoard</span>.cpp"
</li><li>Find the definition of "process()". Add in a new condition corresponding to the mode's name. Code here will be carried out in <code>loop()</code>, so write your logic as you would in your sketch.
</li><li>Save and close <span class='wikiword'>ArduinoRobotMotorBoard</span>.cpp
</li><li>In your sketches for the Robot's Control Board, you can now use "setMode(MODE_MY_MODE_NAME )" to switch to your new mode
</li></ul><p class='vspace'></p><h3>Commands</h3>
<p>There are two different types of commands: 
</p>
<p class='vspace'></p><ul><li>orders (1-directional communication) :  Similar to <a class='wikilink' href='RobotMotorsWrite.html'>motorsWrite</a>(), the Control board sends a command, that the Motor Board receives and carries out. Nothing is sent back to the command board. 
<p class='vspace'></p></li><li>queries (2-directional communications) :  Like with <a class='wikilink' href='RobotUpdateIR.html'>updateIR</a>(), the control board sends a message to the motor board, which then returns data to the control.
</li></ul><p class='vspace'></p><p>To create a new command, you need to define the command code and write the send/receive code for it.
</p>
<p class='vspace'></p><h4>Define a New Command</h4>
<ul><li>In your OS, navigate to the Arduino sketches folder.
</li><li>Open "libraries/<span class='wikiword'>Robot_Control/ArduinoRobot</span>.h" and "libraries/<span class='wikiword'>Robot_Motor/ArduinoRobotMotorBoard</span>.h"
</li><li>Open "libraries/<span class='wikiword'>Robot_Control/ArduinoRobot</span>.h" and "libraries/<span class='wikiword'>Robot_Motor/ArduinoRobotMotorBoard</span>.h" in the text editor of your choice
</li><li>In each file, find the section with the command definitions. It looks like this : 
</li></ul><p>
<div class='sourceblock ' id='sourceblock2'>
  <div class='sourceblocktext'><div>//Command code<br/>#define COMMAND_SWITCH_MODE 0<br/>#define COMMAND_RUN	10<br/>#define COMMAND_MOTORS_STOP	11<br/>..........<br/>#define COMMAND_READ_TRIM_RE 81<br/>#define COMMAND_PAUSE_MODE 90<br/>#define COMMAND_LINE_FOLLOW_CONFIG 100<br/></div></div>
  <div class='sourceblocklink'><a href='http://www.arduino.cc/en/Reference/RobotMotorWriteYourOwnFirmware?action=sourceblock&amp;num=2' type='text/plain'>[Get Code]</a></div>
</div>

</p><ul><li>add a new command after these in both files, like this : "#define COMMAND_MY_COMMAND_NAME num". <em>num</em> should be a different number than the other commands.
</li><li>If your command is a 2-directional query, define another command code here:"#define COMMAND_MY_COMMAND_NAME_RE num1" which will be used for the returning command. <em>Note that "num1" is a different number than "num" above.</em>
</li><li>Plan the structure of your command. You can have a <code>byte</code> or an <code>int</code> stored in the command. When sending/receiving a command, writing/reading the corresponding data needs to happen in the same order. See the comment starting with "A message structure will be:" for examples.
</li><li>To send the command, you should create a function in the <span class='wikiword'>RobotControl</span> library. For an example of how to send a message, see the "motorsWrite()" function in motors.cpp, or "updateIR()" in sensors.cpp.
</li><li>To identify the command, find the "parseCommand()" function in <span class='wikiword'>ArduinoRobotMotorBoard</span>.cpp. Add a new condition to the case clause that is the same name as the command you defined earlier. Refer to the other conditions as examples.
</li><li>If your command is an order, write the function to carry out the logic and you're all set. If it's a query, you'll need to write the function that executes the command, as well as one to return the requested information. Refer to   "_digitalRead()" in <span class='wikiword'>ArduinoRobotMotorBoard</span>.cpp for an example.
</li></ul><p><a class='wikilink' href='HomePage.html'>Reference Home</a>
</p>
<p class='vspace'></p><p><em>Corrections, suggestions, and new documentation should be posted to the <a class='urllink' href='http://arduino.cc/forum/index.php/board,23.0.html' rel='nofollow'>Forum</a>.</em>
</p>
<p class='vspace'></p><p>The text of the Arduino reference is licensed under a
<a class='urllink' href='http://creativecommons.org/licenses/by-sa/3.0/' rel='nofollow'>Creative Commons Attribution-ShareAlike 3.0 License</a>.  Code samples in the reference are released into the public domain.
</p>
</div>

				
				<!-- AddThis Button Style BEGIN -->
<style>
  .addthis_toolbox {
    margin: 2em 0 1em;
  }
  .addthis_toolbox img {
    float: left;
    height: 25px;
    margin-right: 10px;
    width: auto;
  }
  .addthis_toolbox .social-container {
    float: left;
    height: 27px; 
    width: auto; 
  }
  .addthis_toolbox .social-container .social-content {
    float: left;
    margin-top: 2px;
    max-width: 0;
    overflow: hidden;
    -moz-transition: max-width .3s ease-out;
    -webkit-transition: max-width .3s ease-out;
    -o-transition: max-width .3s ease-out;
    transition: max-width .3s ease-out;
  }
  .addthis_toolbox .social-container:hover .social-content {
    max-width: 100px;
    -moz-transition: max-width .2s ease-in;
    -webkit-transition: max-width .2s ease-in;
    -o-transition: max-width .2s ease-in;
    transition: max-width .2s ease-in;
  }
  .addthis_toolbox .social-container .social-content a {
    float: left;
    margin-right: 5px;
  }

  .addthis_toolbox h3 {
    font-size: 24px;
    text-align: left;
  }
</style>
<!-- AddThis Button Style END -->
<!-- AddThis Button BEGIN -->
 
	
	<!--[if gte IE 9]><!-->
	<script src="http://arduino.cc/js/foundation.min.js"></script>
	<script src="http://arduino.cc/js/foundation.topbar.custom.js"></script>
	<script>
	  $(document).foundation();
	</script>
	<!--<![endif]-->
	<!--[if IE 8]>
	<script src="//arduino.cc/js/foundation_ie8.min.js"></script>
	<script src="//arduino.cc/js/ie8/jquery.foundation.orbit.js"></script>
	<script src="//arduino.cc/js/ie8/jquery.foundation.alerts.js"></script>
	<script src="//arduino.cc/js/app.js"></script>
	
	<script>
	$(window).load(function(){
	  $("#featured").orbit();
	});
	</script>
	<![endif]-->
	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-22581631-3']);
	  _gaq.push(['_setDomainName', 'arduino.cc']);
	  _gaq.push(['_trackPageview']);
	
	    (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>

	<script>
	  $(window).load(function(){
	    $('a').each (function () {
	      href = $(this).attr ('href');
	      if (href !== undefined && href.substring (0, 4) == 'http' && href.indexOf ('https://www.arduino.cc/en/Reference/arduino.cc') == -1)
	        $(this).attr ('target', '_blank');
	    });

	    // js for language dropdown
	    $('.language-dropdown .current').on('click', function(e){
          e.stopPropagation();
          $('.language-dropdown ul').toggle();
        });

        $('.language-dropdown .selector').on('click', function(e){
          e.stopPropagation();
          $('.language-dropdown ul').toggle();
        });

        $(document).on('click', function(){
          $('.language-dropdown ul:visible').hide();  
        });

        $('.language-dropdown li a').on('click', function(e){
        	$('.language-dropdown .current').text($(this).text());
        });

        //js for product pages navbar
        var menu = $(".product-page-nav");
	    var menuItems = menu.find("a");
	    var timeoutId = null;
	    var limitTop = 600;

	    var menuOffset = $('.product-page-nav li').first().offset();
	    if(menuOffset) {
	    	limitTop = menuOffset.top;
	    }
	    var limitBottom = $('.addthis_toolbox').offset().top;

	    var activateSection = function($sectionToActivate) {
	      var label=$sectionToActivate.attr('label');

	      $(".product-page-nav").find('li').removeClass('active');
	      $sectionToActivate.addClass('active');
	    };

	    menuItems.click(function(e){

	     e.preventDefault();
	      var href = $(this).attr("href"),
	          offsetTop = href === "#" ? 0 : $(href).offset().top,
	          adjust = 0;
	      if($(this).parent('li').hasClass('active') === false) {

	          adjust = 80;

	          $('html, body').animate({
	                scrollTop: offsetTop - adjust
	            }, 1500, 'easeOutExpo');

	      }
	    });

	    $(window).scroll(function () {

	      var windscroll = $(window).scrollTop();

	      if(windscroll < limitTop) {
	        $('.menu').removeClass('sticky');
	        $('.menu').removeClass('fixed');
	      }  else {
	        $('.menu').addClass('sticky');
	      }

	      var menuEdgeBottomOffset = $('.menu.columns').offset();
	      var menuEdgeBottom = 0;
	      if(menuEdgeBottomOffset) {
	      	menuEdgeBottom = menuEdgeBottomOffset.top + $('.menu.columns').height();
	      }
	      if(menuEdgeBottom > limitBottom) {
	        $('.menu').fadeOut();
	      } else {
	        $('.menu').fadeIn();
	      }
	      menuItems.each(function(i) {
	        var href = $(this).attr("href");
	        if ($(href).offset().top <= windscroll + 150) {
	          if(timeoutId) {
	            clearTimeout(timeoutId);
	          }
	          timeoutId = setTimeout(activateSection, 60, $(".product-page-nav").find('li').eq(i));
	        }
	      });

	    });

	  });
	</script>
</body>

<!-- Mirrored from www.arduino.cc/en/Reference/RobotMotorWriteYourOwnFirmware by HTTrack Website Copier/3.x [XR&CO'2010], Mon, 26 Oct 2015 14:08:07 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
</html>
